[PHP]
; ─────────────────────────────────────────────────────────────────────────────
; Cbox Base Image - PHP Configuration
; Single source of truth for all Cbox images
; ─────────────────────────────────────────────────────────────────────────────

; Memory & Execution
memory_limit = 256M
max_execution_time = 60
max_input_time = 60

; Upload Limits
upload_max_filesize = 64M
post_max_size = 64M

; ─────────────────────────────────────────────────────────────────────────────
; Realpath Cache (CRITICAL: 20-30% performance improvement)
; ─────────────────────────────────────────────────────────────────────────────
realpath_cache_size = 4096K
realpath_cache_ttl = 600

; Error Handling
error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT
display_errors = Off
display_startup_errors = Off
log_errors = On
error_log = /proc/self/fd/2

; Date & Time
date.timezone = UTC

; Session
session.save_handler = files
session.save_path = /tmp

; Security
expose_php = Off
allow_url_fopen = On
allow_url_include = Off

[opcache]
; Enable OPcache
opcache.enable = 1
opcache.enable_cli = 0

; Memory Configuration
opcache.memory_consumption = 256
opcache.interned_strings_buffer = 16
opcache.max_accelerated_files = 20000

; Performance Tuning
opcache.validate_timestamps = 0
opcache.revalidate_freq = 0
opcache.save_comments = 1
opcache.fast_shutdown = 1

; File Cache (optional, for shared hosting)
;opcache.file_cache = /tmp/opcache

; JIT Configuration (PHP 8+)
opcache.jit = tracing
opcache.jit_buffer_size = 100M

[apcu]
; Enable APCu
apc.enabled = 1
apc.shm_size = 64M
apc.ttl = 7200
apc.gc_ttl = 3600
apc.enable_cli = 0

[redis]
; Redis Session Handler (use with: session.save_handler = redis)
; Enable persistent connections for better performance
redis.session.locking_enabled = 1
redis.session.lock_expire = 30
redis.session.lock_wait_time = 10000
redis.session.lock_retries = 10

; Connection pooling (reduces connection overhead)
; Format: tcp://host:port?persistent=1&database=0&auth=password
; Example: redis.session.save_path = "tcp://redis:6379?persistent=1"

; Cluster support (for Redis Cluster)
; redis.clusters.seeds = "redis-cluster:7000"
; redis.clusters.timeout = 2
; redis.clusters.read_timeout = 2
; redis.clusters.auth = ""

[igbinary]
; Use igbinary for faster serialization (if installed)
; session.serialize_handler = igbinary
igbinary.compact_strings = On
